define("bui/uploader",["jquery","bui/common","bui/uploader/uploader","bui/uploader/queue","bui/uploader/theme","bui/uploader/factory","bui/uploader/file","bui/uploader/validator","bui/uploader/button/htmlButton","bui/uploader/button/swfButton","bui/uploader/type/ajax","bui/uploader/type/flash","bui/uploader/type/iframe","bui/data","bui/list","bui/uploader/button/base","bui/uploader/button/filter","bui/uploader/button/ajbridge","bui/swf","bui/uploader/type/base"],function(e,t,i){var u=e("bui/common"),r=u.namespace("Uploader");u.mix(r,{Uploader:e("bui/uploader/uploader"),Queue:e("bui/uploader/queue"),Theme:e("bui/uploader/theme"),Factory:e("bui/uploader/factory")}),i.exports=r}),define("bui/uploader/uploader",["jquery","bui/common","bui/uploader/file","bui/uploader/theme","bui/uploader/factory","bui/uploader/validator","bui/uploader/queue","bui/uploader/button/htmlButton","bui/uploader/button/swfButton","bui/uploader/type/ajax","bui/uploader/type/flash","bui/uploader/type/iframe","bui/data","bui/list","bui/uploader/button/base","bui/uploader/button/filter","bui/uploader/button/ajbridge","bui/swf","bui/uploader/type/base"],function(e,t,i){function u(e){return p[e]&&p[e]()}function r(e,t,i){n.isFunction(e.set)?e.set(t,i):e[t]=i}var a=e("jquery"),n=e("bui/common"),o=n.Component,l=e("bui/uploader/file"),s=e("bui/uploader/theme"),d=e("bui/uploader/factory"),c=e("bui/uploader/validator"),p={ajax:function(){return!!window.FormData},flash:function(){return!0},iframe:function(){return!0}},f=o.Controller.extend({initializer:function(){var e=this;e._initTheme(),e._initType()},renderUI:function(){var e=this;e._renderButton(),e._renderUploaderType(),e._renderQueue(),e._initValidator()},bindUI:function(){var e=this;e._bindButton(),e._bindUploaderCore(),e._bindQueue()},_initTheme:function(){var e=this,t=s.getTheme(e.get("theme")),i=e.getAttrVals();n.each(t,function(t,u){void 0===i[u]?e.set(u,t):a.isPlainObject(t)&&(n.mix(t,i[u]),e.set(u,t))})},_initType:function(){var e=this,t=e.get("types"),i=e.get("type");i||n.each(t,function(e){return u(e)?(i=e,!1):void 0}),e.set("type",i)},_initValidator:function(){var e=this,t=e.get("validator");t||(t=new c({queue:e.get("queue"),rules:e.get("rules")}),e.set("validator",t))},_renderUploaderType:function(){var e=this,t=e.get("type"),i=e.get("uploaderType"),u=d.createUploadType(t,i);u.set("uploader",e),e.set("uploaderType",u)},_renderButton:function(){var e=this,t=e.get("type"),i=e.get("el"),u=e.get("button");u.isController||(u.render=i,u.autoRender=!0,u=d.createButton(t,u),e.set("button",u)),u.set("uploader",e)},_renderQueue:function(){var e=this,t=e.get("el"),i=e.get("queue");i.isController||(i.render=t,i.autoRender=!0,i=d.createQueue(i),e.set("queue",i)),i.set("uploader",e)},_bindButton:function(){var e=this,t=e.get("button"),i=e.get("queue");t.on("change",function(t){var u=t.files;i.addItems(u),e.fire("change",{items:u})})},_bindQueue:function(){var e=this,t=e.get("queue"),i=(e.get("button"),e.get("validator"));t.on("itemrendered",function(u){var r=u.item,a=t.status(r)||"add";r.isUploaderFile||(r.result=n.cloneObject(r),r=l.create(r)),i.valid(r)||(a="error"),t.updateFileStatus(r,a),e.get("autoUpload")&&e.upload()}),t.on("itemupdated",function(){e.uploadFiles()})},_bindUploaderCore:function(){var e=this,t=e.get("queue"),i=e.get("uploaderType");i.on("start",function(t){var i=t.file;delete i.result,e.fire("start",{item:i})}),i.on("progress",function(i){var u=e.get("curUploadItem"),r=i.loaded,a=i.total;n.mix(u,{total:a,loaded:r,loadedPercent:100*r/a}),t.updateFileStatus(u,"progress"),e.fire("progress",{item:u,total:a,loaded:r})}),i.on("error",function(){var i=e.get("curUploadItem"),u=e.get("error"),r=e.get("complete");t.updateFileStatus(i,"error"),u&&n.isFunction(u)&&u.call(e),e.fire("error",{item:i}),r&&n.isFunction(r)&&r.call(e),e.fire("complete",{item:i}),e.set("curUploadItem",null)}),i.on("complete",function(i){var u=e.get("curUploadItem"),r=i.result,a=e.get("isSuccess"),o=e.get("success"),l=e.get("error"),s=e.get("complete");e.set("curUploadItem",null),u.result=r,a.call(e,r)?(n.mix(u,r),t.updateFileStatus(u,"success"),o&&n.isFunction(o)&&o.call(e,r),e.fire("success",{item:u,result:r})):(t.updateFileStatus(u,"error"),l&&n.isFunction(l)&&l.call(e,r),e.fire("error",{item:u,result:r})),s&&n.isFunction(s)&&s.call(e,r),e.fire("complete",{item:u,result:r})})},uploadFile:function(e){var t=this,i=t.get("queue"),u=t.get("uploaderType"),r=t.get("curUploadItem");e&&!r&&(t.set("curUploadItem",e),i.updateFileStatus(e,"start"),u.upload(e))},uploadFiles:function(){var e=this,t=e.get("queue"),i=t.getItemsByStatus("wait");i&&i.length&&e.uploadFile(i[0])},upload:function(){var e=this,t=e.get("queue"),i=t.getItemsByStatus("add");n.each(i,function(e){t.updateFileStatus(e,"wait")})},cancel:function(e){var t=this;return e?void t._cancel(e):void n.each(t.get("queue").getItemsByStatus("wait"),function(e){t._cancel(e)})},_cancel:function(e){var t=this,i=t.get("queue"),u=t.get("uploaderType"),r=t.get("curUploadItem");r===e&&(u.cancel(),t.set("curUploadItem",null)),i.updateFileStatus(e,"cancel"),t.fire("cancel",{item:e})},isValid:function(){var e=this,t=e.get("queue");return t.getItemsByStatus("success").length===t.getItems().length}},{ATTRS:{types:{value:["ajax","flash","iframe"]},type:{},theme:{value:"default"},button:{value:{},shared:!1},text:{setter:function(e){return r(this.get("button"),"text",e),e}},name:{setter:function(e){return r(this.get("button"),"name",e),r(this.get("uploaderType"),"fileDataName",e),e}},disabled:{value:!1,setter:function(e){return r(this.get("button"),"disabled",e),e}},multiple:{value:!0,setter:function(e){return r(this.get("button"),"multiple",e),e}},filter:{setter:function(e){return r(this.get("button"),"filter",e),e}},uploaderType:{value:{},shared:!1},url:{setter:function(e){return r(this.get("uploaderType"),"url",e),e}},data:{setter:function(e){return r(this.get("uploaderType"),"data",e),e}},queue:{value:{},shared:!1},resultTpl:{setter:function(e){return r(this.get("queue"),"resultTpl",e),e}},autoUpload:{value:!0},uploadStatus:{},isSuccess:{value:function(e){return e&&e.url?!0:!1}},validator:{},events:{value:{change:!1,start:!1,progress:!1,success:!1,error:!1,complete:!1,cancel:!1}}}},{xclass:"uploader"});i.exports=f}),define("bui/uploader/queue",["jquery","bui/common","bui/data","bui/list"],function(e,t,i){var u=e("jquery"),r=e("bui/common"),a=e("bui/list").SimpleList,n=r.prefix+"queue",o=n+"-item",l=a.extend({bindUI:function(){var e=this,t=e.get("el"),i=e.get("delCls");t.delegate("."+i,"click",function(t){var i=u(t.target).parents(".bui-queue-item"),r=e.getItemByElement(i);e.fire("beforeremove",{item:r})!==!1&&e.removeItem(r)})},removeItem:function(e){var t=this,i=t.get("uploader");i&&i.cancel&&i.cancel(e),l.superclass.removeItem.call(t,e)},updateFileStatus:function(e,t,i){var u=this,a=u.get("itemStatusFields");i=i||u.findElement(e),r.each(a,function(t,r){u.setItemStatus(e,r,!1,i)}),u.setItemStatus(e,t,!0,i),u._setResultTpl(e,t),u.updateItem(e)},_setResultTpl:function(e,t){var i=this,u=i.get("resultTpl"),a=u[t]||u["default"],n=r.mix(e,e.result);e.resultTpl=r.substitute(a,n)},status:function(e){var t,i=this,u=i.get("itemStatusFields");return r.each(u,function(i){return e[i]?(t=i,!1):void 0}),t}},{ATTRS:{itemTpl:{value:'<li>{resultTpl} <span class="action"><span class="'+o+'-del">\u5220\u9664</span></span></li>'},resultTpl:{value:{"default":'<div class="default">{name}</div>',success:'<div data-url="{url}" class="success">{name}</div>',error:'<div class="error"><span title="{name}">{name}</span><span class="uploader-error">{msg}</span></div>',progress:'<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'},setter:function(e){return r.mix({},this.get("resultTpl"),e)}},itemCls:{value:o},delCls:{value:o+"-del"},itemStatusFields:{value:{add:"add",wait:"wait",start:"start",progress:"progress",success:"success",cancel:"cancel",error:"error"}}}},{xclass:"queue"});i.exports=l}),define("bui/uploader/theme",["jquery","bui/common"],function(e,t,i){var u=e("bui/common"),r={},a={addTheme:function(e,t){r[e]=t},getTheme:function(e){return u.cloneObject(r[e])}};a.addTheme("default",{elCls:"defaultTheme"}),a.addTheme("imageView",{elCls:"imageViewTheme",queue:{resultTpl:{success:'<div class="success"><img src="{url}" /></div>'}}}),i.exports=a}),define("bui/uploader/factory",["jquery","bui/common","bui/uploader/queue","bui/uploader/button/htmlButton","bui/uploader/button/swfButton","bui/uploader/type/ajax","bui/uploader/type/flash","bui/uploader/type/iframe","bui/data","bui/list","bui/uploader/file","bui/uploader/button/base","bui/uploader/button/filter","bui/uploader/button/ajbridge","bui/swf","bui/uploader/type/base"],function(e,t,i){function u(){}var r=(e("bui/common"),e("bui/uploader/queue")),a=e("bui/uploader/button/htmlButton"),n=e("bui/uploader/button/swfButton"),o=e("bui/uploader/type/ajax"),l=e("bui/uploader/type/flash"),s=e("bui/uploader/type/iframe");u.prototype={createUploadType:function(e,t){return"ajax"===e?new o(t):"flash"===e?new l(t):new s(t)},createButton:function(e,t){return"ajax"===e||"iframe"===e?new a(t):new n(t)},createQueue:function(e){return new r(e)}},i.exports=new u}),define("bui/uploader/file",["jquery","bui/common"],function(e,t,i){function u(e){return e.replace(/.*(\/|\\)/,"")}function r(e){var t=/\.[^\.]+$/.exec(e)||[];return t.join("").toLowerCase()}function a(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["KB","MB","GB","TB","PB","EB"][t]}var n=e("bui/common");i.exports={create:function(e){return e.id=e.id||n.guid("bui-uploader-file"),e.name=u(e.name),e.ext=r(e.name),e.textSize=a(e.size),e.isUploaderFile=!0,e}}}),define("bui/uploader/validator",["jquery","bui/common"],function(e,t,i){function u(e){u.superclass.constructor.call(this,e)}var r=e("jquery"),a=e("bui/common");u.ATTRS={rules:{},queue:{}},a.extend(u,a.Base),a.augment(u,{valid:function(e){return this._validItem(e)},_validItem:function(e){var t=this,i=t.get("rules"),u=!0;return a.each(i,function(i,r){return u=u&&t._validRule(e,r,i)}),u},_validRule:function(e,t,i,r){a.isArray(i)&&(r=a.substitute(i[1],i),i=i[0]);var n=u.getRule(t),o=n&&n.call(this,e,i,r),l=this._getResult(o);return l?(e.result=l,!1):!0},_getResult:function(e){return e?{msg:e}:void 0}});var n={};u.addRule=function(e,t){n[e]=t},u.getRule=function(e){return n[e]},u.addRule("maxSize",function(e,t,i){return e.size>1024*t?i:void 0}),u.addRule("minSize",function(e,t,i){return e.size<1024*t?i:void 0}),u.addRule("max",function(e,t,i){var u=this.get("queue").getCount();return u>t?i:void 0}),u.addRule("min",function(e,t,i){var u=this.get("queue").getCount();return t>u?i:void 0}),u.addRule("ext",function(e,t,i){var u=e.ext,t=t.split(",");return-1===r.inArray(u,t)?i:void 0}),i.exports=u}),define("bui/uploader/button/htmlButton",["jquery","bui/common","bui/uploader/file","bui/uploader/button/base","bui/uploader/button/filter"],function(e,t,i){var u=e("jquery"),r=e("bui/common"),a=(r.Component,e("bui/uploader/file")),n=e("bui/uploader/button/base"),o=r.UA,l=n.extend({renderUI:function(){var e=this;e._createInput()},_createInput:function(){var e,t=this,i=t.get("buttonCls"),u=t.get("el").find("."+i),a=t.get("inputTpl"),n=t.get("name");a=r.substitute(a,{name:n}),u.append(a),e=u.find("input"),6==o.ie&&e.css("fontSize","400px"),t._bindChangeHandler(e),t.set("fileInput",e),t._uiSetMultiple(t.get("multiple")),t._uiSetDisabled(t.get("disabled")),t._uiSetFilter(t.get("filter"))},_bindChangeHandler:function(e){var t=this;u(e).on("change",function(i){var n=u(this).val(),o=i.target.files,l=[];o?r.each(o,function(t){l.push(a.create({name:t.name,type:t.type,size:t.size,file:t,input:e}))}):l.push(a.create({name:n,input:e})),t.fire("change",{files:l,input:this}),t.reset()})},reset:function(){var e=this,t=e.get("fileInput");return t.parent().remove(),e.set("fileInput",null),e._createInput(),e},_uiSetMultiple:function(e){var t=this,i=t.get("fileInput");return i&&i.length?(e?i.attr("multiple","multiple"):i.removeAttr("multiple"),e):!1},_uiSetDisabled:function(e){var t=this,i=t.get("fileInput");e?i.hide():i.show()},_uiSetFilter:function(e){var t=this,i=t.get("fileInput"),u=t.getFilter(e);return i&&i.length?(u.type&&i.attr("accept",u.type),u):!1},_uiSetName:function(e){u(this.get("fileInput")).attr("name",e)}},{ATTRS:{inputTpl:{view:!0,value:'<div class="file-input-wrapper"><input type="file" name="{name}" hidefocus="true" class="file-input" /></div>'},fileInput:{}}},{xclass:"uploader-htmlButton"});i.exports=l}),define("bui/uploader/button/swfButton",["jquery","bui/common","bui/uploader/file","bui/uploader/button/base","bui/uploader/button/ajbridge","bui/uploader/button/filter","bui/swf"],function(e,t,i){function u(){return window.seajs?seajs.pluginSDK?seajs.pluginSDK.util.loaderDir:seajs.data.base:window.KISSY?KISSY.Config.packages.bui.base:void 0}var r=e("jquery"),a=e("bui/common"),n=(a.Component,e("bui/uploader/file")),o=e("bui/uploader/button/base"),l=u(),s=e("bui/uploader/button/ajbridge"),d=o.extend({renderUI:function(){var e=this;e._initSwfUploader()},bindUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(){e.fire("swfReady",{swfUploader:t}),t.on("fileSelect",function(t){var i=t.fileList,u=[];a.each(i,function(e){u.push(n.create(e))}),e.fire("change",{files:u})})})},syncUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(){e._uiSetMultiple(e.get("multiple")),e._uiSetFilter(e.get("filter"))})},_initSwfUploader:function(){var e,t=this,i=t.get("buttonCls"),u=t.get("el").find("."+i),n=t.get("flash"),o=t.get("flashUrl"),l=t.get("swfTpl"),d=r(l).appendTo(u);a.mix(n,{render:d,src:o}),e=new s(n),t.set("swfEl",d),t.set("swfUploader",e)},_uiSetMultiple:function(e){var t=this,i=t.get("swfUploader");return i&&i.multifile(e),e},_uiSetDisabled:function(e){var t=this,i=t.get("swfEl");return e?i.hide():i.show(),e},_convertFilter:function(e){var t=(e.desc,[]);return a.each(e.ext.split(","),function(e){e&&t.push("*"+e)}),e.ext=t.join(";"),e},_uiSetFilter:function(e){var t=this,i=t.get("swfUploader"),u=t._convertFilter(t.getFilter(e));return i&&i.filter([u]),e}},{ATTRS:{swfEl:{},swfUploader:{},flashUrl:{value:l+"uploader.swf"},flash:{value:{params:{allowscriptaccess:"always",bgcolor:"#fff",wmode:"transparent",flashvars:{hand:!0,btn:!0,jsEntry:"BUI.AJBridge.eventHandler"}}},shared:!1},swfTpl:{view:!0,value:'<div class="uploader-button-swf"></div>'}}},{xclass:"uploader-swfButton"});i.exports=d}),define("bui/uploader/type/ajax",["bui/uploader/type/base","jquery","bui/common"],function(e,t,i){function u(e){var t=this;u.superclass.constructor.call(t,e)}var r="[uploader-Ajax]:",a=e("bui/uploader/type/base");BUI.extend(u,a,{upload:function(e){if(!e||!e.file)return BUI.log(r+"upload()\uff0cfileData\u53c2\u6570\u6709\u8bef\uff01"),!1;var t=this;return t.set("file",e),t.fire("start",{file:e}),t._setFormData(),t._addFileData(e.file),t.send(),t},cancel:function(){var e=this,t=e.get("xhr"),i=e.get("file");return t&&(t.abort(),e.fire("cancel",{file:i})),e.set("file",null),e},send:function(){var e=this,t=e.get("url"),i=e.get("formData"),u=e.get("file"),r=new XMLHttpRequest;return r.upload.addEventListener("progress",function(t){e.fire("progress",{loaded:t.loaded,total:t.total})}),r.onload=function(){var t=e._processResponse(r.responseText);e.fire("complete",{result:t,file:u})},r.onerror=function(){e.fire("error",{file:u})},r.open("POST",t,!0),r.send(i),e._setFormData(),e.set("xhr",r),e},reset:function(){},_setFormData:function(){var e=this;try{e.set("formData",new FormData),e._processData()}catch(t){BUI.log(r+"something error when reset FormData."),BUI.log(t,"dir")}},_processData:function(){var e=this,t=e.get("data"),i=e.get("formData");BUI.each(t,function(e,t){i.append(t,e)}),e.set("formData",i)},_addFileData:function(e){if(!e)return BUI.log(r+"_addFileData()\uff0cfile\u53c2\u6570\u6709\u8bef\uff01"),!1;var t=this,i=t.get("formData"),u=t.get("fileDataName");i.append(u,e),t.set("formData",i)}},{ATTRS:{formData:{},xhr:{},events:{value:{progress:!1}}}}),i.exports=u}),define("bui/uploader/type/flash",["jquery","bui/uploader/type/base","bui/common"],function(e,t,i){function u(e){var t=this;u.superclass.constructor.call(t,e)}var r=e("jquery"),a=e("bui/uploader/type/base"),n="[uploader-Flash]:",o=new RegExp("^([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),l=new RegExp("^(?:([\\w\\d+.-]+):)?(?://([\\w\\d\\-\\u0100-\\uffff.+%]*))?.*$");BUI.extend(u,a,{_initSwfUploader:function(){var e=this,t=e.get("swfUploader");return t?(e.fire("swfReady"),e._hasCrossdomain(),t.on("uploadStart",function(){var t=e.get("file");e.fire("start",{file:t})}),t.on("uploadProgress",function(t){BUI.mix(t,{loaded:t.bytesLoaded,total:t.bytesTotal}),BUI.log(n+"\u5df2\u7ecf\u4e0a\u4f20\u5b57\u8282\u6570\u4e3a\uff1a"+t.bytesLoaded),e.fire("progress",{loaded:t.loaded,total:t.total})}),t.on("uploadCompleteData",function(t){var i=e.get("file"),u=e._processResponse(t.data);e.fire("complete",{result:u,file:i}),e.set("file",null)}),void t.on("uploadError",function(){var t=e.get("file");e.fire("error",{file:t}),e.set("file",null)})):(BUI.log(n+"swfUploader\u5bf9\u8c61\u4e3a\u7a7a\uff01"),!1)},upload:function(e){var t=this,i=t.get("swfUploader"),u=t.get("url"),r="POST",a=t.get("data"),n=t.get("fileDataName");if(e)return t.set("file",e),i.upload(e.id,u,r,a,n),t},cancel:function(){var e=this,t=e.get("swfUploader"),i=e.get("file");return i&&(t.cancel(i.id),e.fire("cancel",{file:i}),e.set("file",null)),e},_hasCrossdomain:function(){var e=this,t=e.get("url").match(l)||[],i=e.get("swfUploader").get("src").match(l)||[],u=t[2],a=i[2];u&&a&&u!==a&&r.ajax({url:t[1]+"://"+u+"/crossdomain.xml",dataType:"xml",error:function(){BUI.log("\u7f3a\u5c11crossdomain.xml\u6587\u4ef6\u6216\u8be5\u6587\u4ef6\u4e0d\u5408\u6cd5\uff01")}})}},{ATTRS:{uploader:{setter:function(e){var t=this;if(e&&e.isController){var i=e.get("button");i.on("swfReady",function(e){t.set("swfUploader",e.swfUploader),t._initSwfUploader()})}}},url:{setter:function(e){var t=/^http/;if(!t.test(e)){var i,u=location.href.match(o)||[],r=u[1]||"",a=r.split("/");i=BUI.Array.filter(a,function(e,t){return t<a.length-1}),e=i.join("/")+"/"+e}return e}},swfUploader:{},uploadingId:{},events:{value:{swfReady:!1,progress:!1}}}}),i.exports=u}),define("bui/uploader/type/iframe",["jquery","bui/uploader/type/base","bui/common"],function(e,t,i){function u(e){var t=this;u.superclass.constructor.call(t,e)}var r=e("jquery"),a=e("bui/uploader/type/base"),n="bui-uploader-iframe-";BUI.extend(u,a,{upload:function(e){var t,i=this,u=e.input;return e?(i.fire("start",{file:e}),i.set("file",e),i.set("fileInput",u),i._create(),t=i.get("form"),void(t&&t[0].submit())):!1},cancel:function(){{var e=this;e.get("iframe")}return e.reset(),e.fire("cancel"),e},dataToHidden:function(e){if(!r.isPlainObject(e)||r.isEmptyObject(e))return"";var t=this,i=[],u=t.get("tpl"),a=u.HIDDEN_INPUT;if(!BUI.isString(a))return"";for(var n in e)i.push(BUI.substitute(a,{name:n,value:e[n]}));return i.join()},_createIframe:function(){var e,t=this,i=n+BUI.guid(),u=t.get("tpl"),a=(u.IFRAME,t.get("iframe"));return r.isEmptyObject(a)?(e=r(BUI.substitute(u.IFRAME,{id:i})),r("body").append(e),e.on("load",function(e){t._iframeLoadHandler(e)}),t.set("id",i),t.set("iframe",e),e):a},_iframeLoadHandler:function(e){var t,i=this,u=e.target,r=u.contentDocument||window.frames[u.id].document;if(!r||!r.body)return i.fire("error",{msg:"\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u6709\u95ee\u9898\uff01"}),!1;var a=r.body.innerHTML;return""==a?void i.fire("error"):(t=i._processResponse(a),i.fire("complete",{result:t,file:i.get("file")}),void i.reset())},_createForm:function(){var e,t,i=this,u=i.get("id"),a=i.get("tpl"),n=a.FORM,o=i.get("data"),l=i.get("url"),s=i.get("fileInput");return BUI.isString(n)&&BUI.isString(l)?(e=i.dataToHidden(o),e+=i.dataToHidden({type:"iframe"}),t=BUI.substitute(n,{action:l,target:u,hiddenInputs:e}),t=r(t).append(s),r("body").append(t),i.set("form",t),t):!1},_create:function(){var e=this,t=e._createIframe(),i=e._createForm();e.fire("create",{iframe:t,form:i})},_remove:function(){var e=this,t=e.get("form");return t?(t.remove(),e.set("form",null),void e.fire("remove",{form:t})):!1},reset:function(){var e=this;e._remove(),e.set("file",null)}},{ATTRS:{tpl:{value:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}" style="visibility: hidden;">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'}},id:{value:n+BUI.guid()},iframe:{value:{}},form:{},fileInput:{},events:{value:{create:!1,remove:!1}}}}),i.exports=u}),define("bui/uploader/button/base",["jquery","bui/common","bui/uploader/button/filter"],function(e,t,i){var u=e("bui/common"),r=u.Component,a=e("bui/uploader/button/filter"),n=u.prefix,o=n+"uploader",l=o+"-button",s=l+"-text",d=r.View.extend({_uiSetText:function(){var e=this,t=e.get("text"),i=e.get("textCls"),u=e.get("el").find("."+i);u.text(t)}},{ATTRS:{}},{xclass:"uploader-button-view"}),c=r.Controller.extend({getFilter:function(e){if(e){var t=[],i=[],u=[];return e.desc&&(t.push(e.desc),i.push(a.getExtByDesc(e.desc)),u.push(a.getTypeByDesc(e.desc))),e.ext&&(i.push(e.ext),u.push(a.getTypeByExt(e.ext))),e.type,{desc:t.join(","),ext:i.join(","),type:u.join(",")}}}},{ATTRS:{buttonCls:{value:l+"-wrap",view:!0},textCls:{value:s,view:!0},text:{view:!0,value:"\u4e0a\u4f20\u6587\u4ef6"},name:{value:"fileData"},tpl:{view:!0,value:'<a href="javascript:void(0);" class="'+l+'-wrap"><span class="'+s+'">{text}</span></a>'},disabled:{value:!1},multiple:{value:!0},filter:{shared:!1,value:[]},events:{value:{change:!1}},xview:{value:d}}},{xclass:"uploader-button"});c.View=d,i.exports=c}),define("bui/uploader/button/filter",["jquery","bui/common"],function(e,t,i){var u=e("bui/common"),r={msexcel:{type:"application/msexcel",ext:".xls,.xlsx"},msword:{type:"application/msword",ext:".doc,.docx"},gif:{type:"image/gif",ext:".gif"},jpeg:{type:"image/jpeg",ext:".jpg"},bmp:{type:"image/x-ms-bmp",ext:".bmp"},png:{type:"image/png",ext:".png"}};i.exports={_getValueByDesc:function(e,t){var i=[];return u.isString(e)&&(e=e.split(",")),u.isArray(e)&&u.each(e,function(e){var u=r[e];u&&u[t]&&i.push(u[t])}),i.join(",")},getTypeByDesc:function(e){return this._getValueByDesc(e,"type")},getExtByDesc:function(e){return this._getValueByDesc(e,"ext")},getTypeByExt:function(e){var t=[];return u.isString(e)&&(e=e.split(",")),u.isArray(e)&&u.each(e,function(e){u.each(r,function(i){u.Array.indexOf(e,i.ext.split(","))>-1&&t.push(i.type)})}),t.join(",")}}}),define("bui/uploader/button/ajbridge",["jquery","bui/common","bui/swf"],function(e,t,i){function u(e){u.superclass.constructor.call(this,e)}var r=e("bui/common"),a=e("bui/swf"),n={};r.mix(u,{eventHandler:function(e,t){var i=n[e];i&&i.__eventHandler(e,t)},augment:function(e,t){r.isString(t)&&(t=[t]),r.isArray(t)&&r.each(t,function(t){e.prototype[t]=function(){try{return this.callSWF(t,Array.prototype.slice.call(arguments,0))}catch(e){this.fire("error",{message:e})}}})}}),r.extend(u,a),r.augment(u,{initializer:function(){u.superclass.initializer.call(this);var e=this,t=e.get("attrs"),i=t.id;n[i]=e,e.set("id",i)},__eventHandler:function(e,t){var i=this,u=t.type;switch(t.id=e,u){case"log":r.log(t.message);break;default:i.fire(u,t)}},destroy:function(){u.superclass.destroy.call(this);var e=this.get("id");n[e]&&delete n[e]}}),u.augment(u,["activate","getReady","getCoreVersion","setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]),r.AJBridge=u,i.exports=u}),define("bui/uploader/type/base",["jquery","bui/common"],function(e,t,i){function u(e){var t=this;u.superclass.constructor.call(t,e)}var r=e("bui/common");u.ATTRS={file:{},url:{},data:{},fileDataName:{value:"Filedata"},events:{value:{start:!1,cancel:!1,success:!1,error:!1}}},r.extend(u,r.Base,{upload:function(){},cancel:function(){},_processResponse:function(e){{var t,i=this;i.get("file")}if(r.isString(e))try{t=r.JSON.parse(e)}catch(u){t=e}else r.isObject(e)&&(t=i._fromUnicode(e));return r.log("\u670d\u52a1\u5668\u7aef\u8f93\u51fa\uff1a"+r.JSON.stringify(t)),t},_fromUnicode:function(e){function t(e){r.each(e,function(i,u){r.isObject(e[u])?t(e[u]):e[u]=r.isString(i)&&r.fromUnicode(i)||i})}return r.isObject(e)?(t(e),e):e},reset:function(){}}),i.exports=u});