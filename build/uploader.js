define("bui/uploader/button/swfButton/ajbridge",["bui/common","bui/swf"],function(require){function e(t){e.superclass.constructor.call(this,t)}var t=require("bui/common"),i=require("bui/swf"),r={};return t.mix(e,{eventHandler:function(e,t){var i=r[e];i&&i.__eventHandler(e,t)},augment:function(e,i){t.isString(i)&&(i=[i]),t.isArray(i)&&t.each(i,function(t){e.prototype[t]=function(){try{return this.callSWF(t,Array.prototype.slice.call(arguments,0))}catch(e){this.fire("error",{message:e})}}})}}),t.extend(e,i),t.augment(e,{initializer:function(){e.superclass.initializer.call(this);var t=this,i=t.get("attrs"),n=i.id;r[n]=t,t.set("id",n)},__eventHandler:function(e,i){var r=this,n=i.type;switch(i.id=e,n){case"log":t.log(i.message);break;default:r.fire(n,i)}},destroy:function(){e.superclass.destroy.call(this);var t=this.get("id");r[t]&&delete r[t]}}),e.augment(e,["activate","getReady","getCoreVersion","setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]),t.AJBridge=e,e}),define("bui/uploader/button/filter",["bui/common"],function(require){var e=require("bui/common"),t={msexcel:{type:"application/msexcel",ext:".xls,.xlsx"},msword:{type:"application/msword",ext:".doc,.docx"},gif:{type:"image/gif",ext:".gif"},jpeg:{type:"image/jpeg",ext:".jpg"},bmp:{type:"image/x-ms-bmp",ext:".bmp"},png:{type:"image/png",ext:".png"}};return{_getValueByDesc:function(i,r){var n=[];return e.isString(i)&&(i=i.split(",")),e.isArray(i)&&e.each(i,function(e){var i=t[e];i&&i[r]&&n.push(i[r])}),n.join(",")},getTypeByDesc:function(e){return this._getValueByDesc(e,"type")},getExtByDesc:function(e){return this._getValueByDesc(e,"ext")},getTypeByExt:function(i){var r=[];return e.isString(i)&&(i=i.split(",")),e.isArray(i)&&e.each(i,function(i){e.each(t,function(t){e.Array.indexOf(i,t.ext.split(","))>-1&&r.push(t.type)})}),r.join(",")}}}),define("bui/uploader/button/base",["bui/common","./filter"],function(require){var e=require("bui/common"),t=e.Component,i=require("bui/uploader/button/filter"),r=e.prefix,n=r+"uploader",a=n+"-button",u=a+"-text",o=t.View.extend({_uiSetText:function(){var e=this,t=e.get("text"),i=e.get("textCls"),r=e.get("el").find("."+i);r.text(t)}},{ATTRS:{}},{xclass:"uploader-button-view"}),l=t.Controller.extend({getFilter:function(e){if(e){var t=[],r=[],n=[];return e.desc&&(t.push(e.desc),r.push(i.getExtByDesc(e.desc)),n.push(i.getTypeByDesc(e.desc))),e.ext&&(r.push(e.ext),n.push(i.getTypeByExt(e.ext))),e.type,{desc:t.join(","),ext:r.join(","),type:n.join(",")}}}},{ATTRS:{buttonCls:{value:a+"-wrap",view:!0},textCls:{value:u,view:!0},text:{view:!0,value:"\u4e0a\u4f20\u6587\u4ef6"},name:{value:"fileData"},tpl:{view:!0,value:'<a href="javascript:void(0);" class="'+a+'-wrap"><span class="'+u+'">{text}</span></a>'},disabled:{value:!1},multiple:{value:!0},filter:{shared:!1,value:[]},events:{value:{change:!1}},xview:{value:o}}},{xclass:"uploader-button"});return l.View=o,l}),define("bui/uploader/button/htmlButton",["bui/uploader/file","bui/uploader/button/base"],function(require){var e=require("bui/common"),t=(e.Component,require("bui/uploader/file")),i=require("bui/uploader/button/base"),r=e.UA,n=i.extend({renderUI:function(){var e=this;e._createInput()},_createInput:function(){var t,i=this,n=i.get("buttonCls"),a=i.get("el").find("."+n),u=i.get("inputTpl"),o=i.get("name");u=e.substitute(u,{name:o}),a.append(u),t=a.find("input"),6==r.ie&&t.css("fontSize","400px"),i._bindChangeHandler(t),i.set("fileInput",t),i._uiSetMultiple(i.get("multiple")),i._uiSetDisabled(i.get("disabled")),i._uiSetFilter(i.get("filter"))},_bindChangeHandler:function(i){var r=this;$(i).on("change",function(n){var a=$(this).val(),u=n.target.files,o=[];u?e.each(u,function(e){o.push(t.create({name:e.name,type:e.type,size:e.size,file:e,input:i}))}):o.push(t.create({name:a,input:i})),r.fire("change",{files:o,input:this}),r.reset()})},reset:function(){var e=this,t=e.get("fileInput");return t.parent().remove(),e.set("fileInput",null),e._createInput(),e},_uiSetMultiple:function(e){var t=this,i=t.get("fileInput");return i&&i.length?(e?i.attr("multiple","multiple"):i.removeAttr("multiple"),e):!1},_uiSetDisabled:function(e){var t=this,i=t.get("fileInput");e?i.hide():i.show()},_uiSetFilter:function(e){var t=this,i=t.get("fileInput"),r=t.getFilter(e);return i&&i.length?(r.type&&i.attr("accept",r.type),r):!1},_uiSetName:function(e){$(this.get("fileInput")).attr("name",e)}},{ATTRS:{inputTpl:{view:!0,value:'<div class="file-input-wrapper"><input type="file" name="{name}" hidefocus="true" class="file-input" /></div>'},fileInput:{}}},{xclass:"uploader-htmlButton"});return n}),define("bui/uploader/button/swfButton",["bui/common","bui/uploader/file","./base","./swfButton/ajbridge"],function(require){function e(){return window.seajs?seajs.pluginSDK?seajs.pluginSDK.util.loaderDir:seajs.data.base:window.KISSY?KISSY.Config.packages.bui.base:void 0}var t=require("bui/common"),i=(t.Component,require("bui/uploader/file")),r=require("bui/uploader/button/base"),n=e(),a=require("bui/uploader/button/swfButton/ajbridge"),u=r.extend({renderUI:function(){var e=this;e._initSwfUploader()},bindUI:function(){var e=this,r=e.get("swfUploader");r.on("contentReady",function(){e.fire("swfReady",{swfUploader:r}),r.on("fileSelect",function(r){var n=r.fileList,a=[];t.each(n,function(e){a.push(i.create(e))}),e.fire("change",{files:a})})})},syncUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(){e._uiSetMultiple(e.get("multiple")),e._uiSetFilter(e.get("filter"))})},_initSwfUploader:function(){var e,i=this,r=i.get("buttonCls"),n=i.get("el").find("."+r),u=i.get("flash"),o=i.get("flashUrl"),l=i.get("swfTpl"),s=$(l).appendTo(n);t.mix(u,{render:s,src:o}),e=new a(u),i.set("swfEl",s),i.set("swfUploader",e)},_uiSetMultiple:function(e){var t=this,i=t.get("swfUploader");return i&&i.multifile(e),e},_uiSetDisabled:function(e){var t=this,i=t.get("swfEl");return e?i.hide():i.show(),e},_convertFilter:function(e){var i=(e.desc,[]);return t.each(e.ext.split(","),function(e){e&&i.push("*"+e)}),e.ext=i.join(";"),e},_uiSetFilter:function(e){var t=this,i=t.get("swfUploader"),r=t._convertFilter(t.getFilter(e));return i&&i.filter([r]),e}},{ATTRS:{swfEl:{},swfUploader:{},flashUrl:{value:n+"uploader/uploader.swf"},flash:{value:{params:{allowscriptaccess:"always",bgcolor:"#fff",wmode:"transparent",flashvars:{hand:!0,btn:!0,jsEntry:"BUI.AJBridge.eventHandler"}}},shared:!1},swfTpl:{view:!0,value:'<div class="uploader-button-swf"></div>'}}},{xclass:"uploader-swfButton"});return u}),define("bui/uploader/type/base",["bui/common"],function(require){function e(t){var i=this;e.superclass.constructor.call(i,t)}var t=require("bui/common");return e.ATTRS={file:{},url:{},data:{},fileDataName:{value:"Filedata"},events:{value:{start:!1,cancel:!1,success:!1,error:!1}}},t.extend(e,t.Base,{upload:function(){},cancel:function(){},_processResponse:function(e){{var i,r=this;r.get("file")}if(t.isString(e))try{i=t.JSON.parse(e)}catch(n){i=e}else t.isObject(e)&&(i=r._fromUnicode(e));return t.log("\u670d\u52a1\u5668\u7aef\u8f93\u51fa\uff1a"+t.JSON.stringify(i)),i},_fromUnicode:function(e){function i(e){t.each(e,function(r,n){t.isObject(e[n])?i(e[n]):e[n]=t.isString(r)&&t.fromUnicode(r)||r})}return t.isObject(e)?(i(e),e):e},reset:function(){}}),e}),define("bui/uploader/type/ajax",["./base"],function(require){function e(t){var i=this;e.superclass.constructor.call(i,t)}var t="[uploader-Ajax]:",i=require("bui/uploader/type/base");return BUI.extend(e,i,{upload:function(e){if(!e||!e.file)return BUI.log(t+"upload()\uff0cfileData\u53c2\u6570\u6709\u8bef\uff01"),!1;var i=this;return i.set("file",e),i.fire("start",{file:e}),i._setFormData(),i._addFileData(e.file),i.send(),i},cancel:function(){var e=this,t=e.get("xhr"),i=e.get("file");return t&&(t.abort(),e.fire("cancel",{file:i})),e.set("file",null),e},send:function(){var e=this,t=e.get("url"),i=e.get("formData"),r=e.get("file"),n=new XMLHttpRequest;return n.upload.addEventListener("progress",function(t){e.fire("progress",{loaded:t.loaded,total:t.total})}),n.onload=function(){var t=e._processResponse(n.responseText);e.fire("complete",{result:t,file:r})},n.onerror=function(){e.fire("error",{file:r})},n.open("POST",t,!0),n.send(i),e._setFormData(),e.set("xhr",n),e},reset:function(){},_setFormData:function(){var e=this;try{e.set("formData",new FormData),e._processData()}catch(i){BUI.log(t+"something error when reset FormData."),BUI.log(i,"dir")}},_processData:function(){var e=this,t=e.get("data"),i=e.get("formData");BUI.each(t,function(e,t){i.append(t,e)}),e.set("formData",i)},_addFileData:function(e){if(!e)return BUI.log(t+"_addFileData()\uff0cfile\u53c2\u6570\u6709\u8bef\uff01"),!1;var i=this,r=i.get("formData"),n=i.get("fileDataName");r.append(n,e),i.set("formData",r)}},{ATTRS:{formData:{},xhr:{},events:{value:{progress:!1}}}}),e}),define("bui/uploader/type/flash",["./base"],function(require){function e(t){var i=this;e.superclass.constructor.call(i,t)}var t="[uploader-Flash]:",i=require("bui/uploader/type/base"),r=new RegExp("^([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),n=new RegExp("^(?:([\\w\\d+.-]+):)?(?://([\\w\\d\\-\\u0100-\\uffff.+%]*))?.*$");return BUI.extend(e,i,{_initSwfUploader:function(){var e=this,i=e.get("swfUploader");return i?(e.fire("swfReady"),e._hasCrossdomain(),i.on("uploadStart",function(){var t=e.get("file");e.fire("start",{file:t})}),i.on("uploadProgress",function(i){BUI.mix(i,{loaded:i.bytesLoaded,total:i.bytesTotal}),BUI.log(t+"\u5df2\u7ecf\u4e0a\u4f20\u5b57\u8282\u6570\u4e3a\uff1a"+i.bytesLoaded),e.fire("progress",{loaded:i.loaded,total:i.total})}),i.on("uploadCompleteData",function(t){var i=e.get("file"),r=e._processResponse(t.data);e.fire("complete",{result:r,file:i}),e.set("file",null)}),void i.on("uploadError",function(){var t=e.get("file");e.fire("error",{file:t}),e.set("file",null)})):(BUI.log(t+"swfUploader\u5bf9\u8c61\u4e3a\u7a7a\uff01"),!1)},upload:function(e){var t=this,i=t.get("swfUploader"),r=t.get("url"),n="POST",a=t.get("data"),u=t.get("fileDataName");if(e)return t.set("file",e),i.upload(e.id,r,n,a,u),t},cancel:function(){var e=this,t=e.get("swfUploader"),i=e.get("file");return i&&(t.cancel(i.id),e.fire("cancel",{file:i}),e.set("file",null)),e},_hasCrossdomain:function(){var e=this,t=e.get("url").match(n)||[],i=e.get("swfUploader").get("src").match(n)||[],r=t[2],a=i[2];r&&a&&r!==a&&$.ajax({url:t[1]+"://"+r+"/crossdomain.xml",dataType:"xml",error:function(){BUI.log("\u7f3a\u5c11crossdomain.xml\u6587\u4ef6\u6216\u8be5\u6587\u4ef6\u4e0d\u5408\u6cd5\uff01")}})}},{ATTRS:{uploader:{setter:function(e){var t=this;if(e&&e.isController){var i=e.get("button");i.on("swfReady",function(e){t.set("swfUploader",e.swfUploader),t._initSwfUploader()})}}},url:{setter:function(e){var t=/^http/;if(!t.test(e)){var i,n=location.href.match(r)||[],a=n[1]||"",u=a.split("/");i=BUI.Array.filter(u,function(e,t){return t<u.length-1}),e=i.join("/")+"/"+e}return e}},swfUploader:{},uploadingId:{},events:{value:{swfReady:!1,progress:!1}}}}),e}),define("bui/uploader/type/iframe",["./base"],function(require){function e(t){var i=this;e.superclass.constructor.call(i,t)}var t="bui-uploader-iframe-",i=require("bui/uploader/type/base");return BUI.extend(e,i,{upload:function(e){var t,i=this,r=e.input;return e?(i.fire("start",{file:e}),i.set("file",e),i.set("fileInput",r),i._create(),t=i.get("form"),void(t&&t[0].submit())):!1},cancel:function(){{var e=this;e.get("iframe")}return e.reset(),e.fire("cancel"),e},dataToHidden:function(e){if(!$.isPlainObject(e)||$.isEmptyObject(e))return"";var t=this,i=[],r=t.get("tpl"),n=r.HIDDEN_INPUT;if(!BUI.isString(n))return"";for(var a in e)i.push(BUI.substitute(n,{name:a,value:e[a]}));return i.join()},_createIframe:function(){var e,i=this,r=t+BUI.guid(),n=i.get("tpl"),a=(n.IFRAME,i.get("iframe"));return $.isEmptyObject(a)?(e=$(BUI.substitute(n.IFRAME,{id:r})),$("body").append(e),e.on("load",function(e){i._iframeLoadHandler(e)}),i.set("id",r),i.set("iframe",e),e):a},_iframeLoadHandler:function(e){var t,i=this,r=e.target,n=r.contentDocument||window.frames[r.id].document;if(!n||!n.body)return i.fire("error",{msg:"\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u6709\u95ee\u9898\uff01"}),!1;var a=n.body.innerHTML;return""==a?void i.fire("error"):(t=i._processResponse(a),i.fire("complete",{result:t,file:i.get("file")}),void i.reset())},_createForm:function(){var e,t,i=this,r=i.get("id"),n=i.get("tpl"),a=n.FORM,u=i.get("data"),o=i.get("url"),l=i.get("fileInput");return BUI.isString(a)&&BUI.isString(o)?(e=i.dataToHidden(u),e+=i.dataToHidden({type:"iframe"}),t=BUI.substitute(a,{action:o,target:r,hiddenInputs:e}),t=$(t).append(l),$("body").append(t),i.set("form",t),t):!1},_create:function(){var e=this,t=e._createIframe(),i=e._createForm();e.fire("create",{iframe:t,form:i})},_remove:function(){var e=this,t=e.get("form");return t?(t.remove(),e.set("form",null),void e.fire("remove",{form:t})):!1},reset:function(){var e=this;e._remove(),e.set("file",null)}},{ATTRS:{tpl:{value:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}" style="visibility: hidden;">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'}},id:{value:t+BUI.guid()},iframe:{value:{}},form:{},fileInput:{},events:{value:{create:!1,remove:!1}}}}),e}),define("bui/uploader/file",["bui/common"],function(require){function e(e){return e.replace(/.*(\/|\\)/,"")}function t(e){var t=/\.[^\.]+$/.exec(e)||[];return t.join("").toLowerCase()}function i(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["KB","MB","GB","TB","PB","EB"][t]}var r=require("bui/common");return{create:function(n){return n.id=n.id||r.guid("bui-uploader-file"),n.name=e(n.name),n.ext=t(n.name),n.textSize=i(n.size),n.isUploaderFile=!0,n}}}),define("bui/uploader/queue",["bui/common","bui/list"],function(require){var e=require("bui/common"),t=require("bui/list/simplelist"),i=e.prefix+"queue",r=i+"-item",n=t.extend({bindUI:function(){var e=this,t=e.get("el"),i=e.get("delCls");t.delegate("."+i,"click",function(t){var i=$(t.target).parents(".bui-queue-item"),r=e.getItemByElement(i);e.fire("beforeremove",{item:r})!==!1&&e.removeItem(r)})},removeItem:function(e){var t=this,i=t.get("uploader");i&&i.cancel&&i.cancel(e),n.superclass.removeItem.call(t,e)},updateFileStatus:function(t,i,r){var n=this,a=n.get("itemStatusFields");r=r||n.findElement(t),e.each(a,function(e,i){n.setItemStatus(t,i,!1,r)}),n.setItemStatus(t,i,!0,r),n._setResultTpl(t,i),n.updateItem(t)},_setResultTpl:function(t,i){var r=this,n=r.get("resultTpl"),a=n[i]||n["default"],u=e.mix(t,t.result);t.resultTpl=e.substitute(a,u)},status:function(t){var i,r=this,n=r.get("itemStatusFields");return e.each(n,function(e){return t[e]?(i=e,!1):void 0}),i}},{ATTRS:{itemTpl:{value:'<li>{resultTpl} <span class="action"><span class="'+r+'-del">\u5220\u9664</span></span></li>'},resultTpl:{value:{"default":'<div class="default">{name}</div>',success:'<div data-url="{url}" class="success">{name}</div>',error:'<div class="error"><span title="{name}">{name}</span><span class="uploader-error">{msg}</span></div>',progress:'<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'},setter:function(t){return e.mix({},this.get("resultTpl"),t)}},itemCls:{value:r},delCls:{value:r+"-del"},itemStatusFields:{value:{add:"add",wait:"wait",start:"start",progress:"progress",success:"success",cancel:"cancel",error:"error"}}}},{xclass:"queue"});return n}),define("bui/uploader/theme",["bui/common"],function(require){var e=require("bui/common"),t={},i={addTheme:function(e,i){t[e]=i},getTheme:function(i){return e.cloneObject(t[i])}};return i.addTheme("default",{elCls:"defaultTheme"}),i.addTheme("imageView",{elCls:"imageViewTheme",queue:{resultTpl:{success:'<div class="success"><img src="{url}" /></div>'}}}),i}),define("bui/uploader/validator",["bui/common"],function(require){function e(t){e.superclass.constructor.call(this,t)}var t=require("bui/common");e.ATTRS={rules:{},queue:{}},t.extend(e,t.Base),t.augment(e,{valid:function(e){return this._validItem(e)},_validItem:function(e){var i=this,r=i.get("rules"),n=!0;return t.each(r,function(t,r){return n=n&&i._validRule(e,r,t)}),n},_validRule:function(i,r,n,a){t.isArray(n)&&(a=t.substitute(n[1],n),n=n[0]);var u=e.getRule(r),o=u&&u.call(this,i,n,a),l=this._getResult(o);return l?(i.result=l,!1):!0},_getResult:function(e){return e?{msg:e}:void 0}});var i={};return e.addRule=function(e,t){i[e]=t},e.getRule=function(e){return i[e]},e.addRule("maxSize",function(e,t,i){return e.size>1024*t?i:void 0}),e.addRule("minSize",function(e,t,i){return e.size<1024*t?i:void 0}),e.addRule("max",function(e,t,i){var r=this.get("queue").getCount();return r>t?i:void 0}),e.addRule("min",function(e,t,i){var r=this.get("queue").getCount();return t>r?i:void 0}),e.addRule("ext",function(e,t,i){var r=e.ext,t=t.split(",");return-1===$.inArray(r,t)?i:void 0}),e}),define("bui/uploader/factory",["bui/common","./queue","./button/htmlButton","./button/swfButton","./type/ajax","./type/flash","./type/iframe"],function(require){function e(){}var t=(require("bui/common"),require("bui/uploader/queue")),i=require("bui/uploader/button/htmlButton"),r=require("bui/uploader/button/swfButton"),n=require("bui/uploader/type/ajax"),a=require("bui/uploader/type/flash"),u=require("bui/uploader/type/iframe");return e.prototype={createUploadType:function(e,t){return"ajax"===e?new n(t):"flash"===e?new a(t):new u(t)},createButton:function(e,t){return"ajax"===e||"iframe"===e?new i(t):new r(t)},createQueue:function(e){return new t(e)}},new e}),define("bui/uploader/uploader",["bui/common","./file","./theme","./factory","./validator"],function(require){function e(e){return l[e]&&l[e]()}function t(e,t,r){i.isFunction(e.set)?e.set(t,r):e[t]=r}var i=require("bui/common"),r=i.Component,n=require("bui/uploader/file"),a=require("bui/uploader/theme"),u=require("bui/uploader/factory"),o=require("bui/uploader/validator"),l={ajax:function(){return!!window.FormData},flash:function(){return!0},iframe:function(){return!0}},s=r.Controller.extend({initializer:function(){var e=this;e._initTheme(),e._initType()},renderUI:function(){var e=this;e._renderButton(),e._renderUploaderType(),e._renderQueue(),e._initValidator()},bindUI:function(){var e=this;e._bindButton(),e._bindUploaderCore(),e._bindQueue()},_initTheme:function(){var e=this,t=a.getTheme(e.get("theme")),r=e.getAttrVals();i.each(t,function(t,n){void 0===r[n]?e.set(n,t):$.isPlainObject(t)&&(i.mix(t,r[n]),e.set(n,t))})},_initType:function(){var t=this,r=t.get("types"),n=t.get("type");n||i.each(r,function(t){return e(t)?(n=t,!1):void 0}),t.set("type",n)},_initValidator:function(){var e=this,t=e.get("validator");t||(t=new o({queue:e.get("queue"),rules:e.get("rules")}),e.set("validator",t))},_renderUploaderType:function(){var e=this,t=e.get("type"),i=e.get("uploaderType"),r=u.createUploadType(t,i);r.set("uploader",e),e.set("uploaderType",r)},_renderButton:function(){var e=this,t=e.get("type"),i=e.get("el"),r=e.get("button");r.isController||(r.render=i,r.autoRender=!0,r=u.createButton(t,r),e.set("button",r)),r.set("uploader",e)},_renderQueue:function(){var e=this,t=e.get("el"),i=e.get("queue");i.isController||(i.render=t,i.autoRender=!0,i=u.createQueue(i),e.set("queue",i)),i.set("uploader",e)},_bindButton:function(){var e=this,t=e.get("button"),i=e.get("queue");t.on("change",function(t){var r=t.files;i.addItems(r),e.fire("change",{items:r})})},_bindQueue:function(){var e=this,t=e.get("queue"),r=(e.get("button"),e.get("validator"));t.on("itemrendered",function(a){var u=a.item,o=t.status(u)||"add";u.isUploaderFile||(u.result=i.cloneObject(u),u=n.create(u)),r.valid(u)||(o="error"),t.updateFileStatus(u,o),e.get("autoUpload")&&e.upload()}),t.on("itemupdated",function(){e.uploadFiles()})},_bindUploaderCore:function(){var e=this,t=e.get("queue"),r=e.get("uploaderType");r.on("start",function(t){var i=t.file;delete i.result,e.fire("start",{item:i})}),r.on("progress",function(r){var n=e.get("curUploadItem"),a=r.loaded,u=r.total;i.mix(n,{total:u,loaded:a,loadedPercent:100*a/u}),t.updateFileStatus(n,"progress"),e.fire("progress",{item:n,total:u,loaded:a})}),r.on("error",function(){var r=e.get("curUploadItem"),n=e.get("error"),a=e.get("complete");t.updateFileStatus(r,"error"),n&&i.isFunction(n)&&n.call(e),e.fire("error",{item:r}),a&&i.isFunction(a)&&a.call(e),e.fire("complete",{item:r}),e.set("curUploadItem",null)}),r.on("complete",function(r){var n=e.get("curUploadItem"),a=r.result,u=e.get("isSuccess"),o=e.get("success"),l=e.get("error"),s=e.get("complete");e.set("curUploadItem",null),n.result=a,u.call(e,a)?(i.mix(n,a),t.updateFileStatus(n,"success"),o&&i.isFunction(o)&&o.call(e,a),e.fire("success",{item:n,result:a})):(t.updateFileStatus(n,"error"),l&&i.isFunction(l)&&l.call(e,a),e.fire("error",{item:n,result:a})),s&&i.isFunction(s)&&s.call(e,a),e.fire("complete",{item:n,result:a})})},uploadFile:function(e){var t=this,i=t.get("queue"),r=t.get("uploaderType"),n=t.get("curUploadItem");e&&!n&&(t.set("curUploadItem",e),i.updateFileStatus(e,"start"),r.upload(e))},uploadFiles:function(){var e=this,t=e.get("queue"),i=t.getItemsByStatus("wait");i&&i.length&&e.uploadFile(i[0])},upload:function(){var e=this,t=e.get("queue"),r=t.getItemsByStatus("add");i.each(r,function(e){t.updateFileStatus(e,"wait")})},cancel:function(e){var t=this;return e?void t._cancel(e):void i.each(t.get("queue").getItemsByStatus("wait"),function(e){t._cancel(e)})},_cancel:function(e){var t=this,i=t.get("queue"),r=t.get("uploaderType"),n=t.get("curUploadItem");n===e&&(r.cancel(),t.set("curUploadItem",null)),i.updateFileStatus(e,"cancel"),t.fire("cancel",{item:e})},isValid:function(){var e=this,t=e.get("queue");return t.getItemsByStatus("success").length===t.getItems().length}},{ATTRS:{types:{value:["ajax","flash","iframe"]},type:{},theme:{value:"default"},button:{value:{},shared:!1},text:{setter:function(e){return t(this.get("button"),"text",e),e}},name:{setter:function(e){return t(this.get("button"),"name",e),t(this.get("uploaderType"),"fileDataName",e),e}},disabled:{value:!1,setter:function(e){return t(this.get("button"),"disabled",e),e}},multiple:{value:!0,setter:function(e){return t(this.get("button"),"multiple",e),e}},filter:{setter:function(e){return t(this.get("button"),"filter",e),e}},uploaderType:{value:{},shared:!1},url:{setter:function(e){return t(this.get("uploaderType"),"url",e),e}},data:{setter:function(e){return t(this.get("uploaderType"),"data",e),e}},queue:{value:{},shared:!1},resultTpl:{setter:function(e){return t(this.get("queue"),"resultTpl",e),e}},autoUpload:{value:!0},uploadStatus:{},isSuccess:{value:function(e){return e&&e.url?!0:!1}},validator:{},events:{value:{change:!1,start:!1,progress:!1,success:!1,error:!1,complete:!1,cancel:!1}}}},{xclass:"uploader"});return s}),define("bui/uploader",["bui/common","bui/uploader/uploader","bui/uploader/queue","bui/uploader/theme","bui/uploader/factory"],function(require){var e=require("bui/common"),t=e.namespace("Uploader");return e.mix(t,{Uploader:require("bui/uploader/uploader"),Queue:require("bui/uploader/queue"),Theme:require("bui/uploader/theme"),Factory:require("bui/uploader/factory")}),t});