!function(){var e="bui/imgview";define(e,["bui/common",e+"/imgview",e+"/viewcontent",e+"/previewlist"],function(t){var i=t("bui/common"),n=i.namespace("ImgView");return i.mix(n,{ImgView:t(e+"/imgview"),ViewContent:t(e+"/viewcontent"),PreviewList:t(e+"/previewlist")}),n})}(),define("bui/imgview/imgview",["bui/common","bui/toolbar","bui/imgview/viewcontent","bui/imgview/previewlist"],function(e){var t=e("bui/common"),i=e("bui/imgview/viewcontent"),n=e("bui/imgview/previewlist"),g=e("bui/toolbar"),a=t.Component.Controller.extend({initializer:function(){var e=this,a=(e.get("el"),e.get("children")),r=new i(t.mix(e.get("viewContent"),{elCls:"ui-img-view-content"})),s=new g.Bar({elCls:"ui-img-view-toolbar",children:e.get("commands"),itemTpl:'<a data-cmd="{cmd}" href="javascript:;">{text}</a>'}),h=new n({elCls:"ui-img-view-mini-wrap"});a.push(r),a.push(h),a.push(s),e.set("toolBar",s),e.set("viewContent",r),e.set("previewList",h)},renderUI:function(){var e=this,t=(e.get("toolBar"),e.get("viewContent")),i=e.get("el");t.get("el").append('<a class="paintPrev J_paintPrev" href="#"></a><a class="paintNext J_paintNext" href="#"></a>'),i.addClass("img-view-controls-wrap")},bindUI:function(){this._bindToolbar(),this._bindSelectedChange(),this._bindPrevNext()},_bindPrevNext:function(){var e=this,t=e.get("viewContent"),i=t.get("el");i.hover(function(){i.find(".J_paintPrev,.J_paintNext").show()},function(){i.find(".J_paintPrev,.J_paintNext").hide()}),i.find(".J_paintPrev").on("click",function(t){t.preventDefault(),e.paintPrev()}),i.find(".J_paintNext").on("click",function(t){t.preventDefault(),e.paintNext()})},_bindToolbar:function(){var e=this,t=e.get("viewContent"),i=e.get("toolBar");i.on("click",function(e){var i=e.target,n=i.get("cmd");if("viewImg"==n){var g=t.getSrc();$(e.domTarget).attr("href",g)}else n&&t[n]&&t[n]()})},_bindSelectedChange:function(){var e=this;e.get("previewList").set("selectedchange",function(t,i){var n=e.get("selectedchange"),g=e.get("viewContent"),a=e.get("imgList");a.length&&(g.set("imgSrc",a[i].src),e.set("imgNum",i),n(i,a[i].src))})},getViewContent:function(){return this.get("viewContent")},paintPrev:function(){var e=this,t=e.get("imgNum");t-1>=0&&e.set("imgNum",t-1)},paintNext:function(){var e=this,t=e.get("imgList"),i=e.get("imgNum");i+1<t.length&&e.set("imgNum",i+1)},reset:function(){this.getViewContent().reset()},getLength:function(){return this.get("imgList").length},getSrc:function(){return this.getViewContent().get("imgSrc")},_uiSetWidth:function(e){e=e||this.get("width");var t=this.get("sidebarWidth");this.get("viewContent").set("width",e-t),this.get("toolBar").set("width",e-t)},_uiSetHeight:function(e){e=e||this.get("height"),this.get("viewContent").set("height",e-this.get("toolbarHeight")),this.get("previewList").set("height",e)},_uiSetToolbarHeight:function(e){this.get("toolBar").set("height",e)},_uiSetSidebarWidth:function(e){this.get("previewList").set("width",e)},_uiSetImgNum:function(e){this.get("previewList").set("selected",e)},_uiSetImgList:function(e){var t=this,i=t.get("previewList");i.set("items",e)},destructor:function(){}},{ATTRS:{imgList:{value:[]},imgNum:{value:0},commands:{value:[{cmd:"fitToggle",text:"\u81ea\u52a8\u5927\u5c0f"},{cmd:"resume",text:"\u5b9e\u9645\u5927\u5c0f"},{cmd:"fit",text:"\u9002\u5408\u5927\u5c0f"},{cmd:"leftHand",text:"\u5de6\u65cb"},{cmd:"rightHand",text:"\u53f3\u65cb"},{cmd:"zoom",text:"\u653e\u5927"},{cmd:"micrify",text:"\u7f29\u5c0f"},{cmd:"viewImg",content:'<a href="#" target="_blank">\u67e5\u770b\u539f\u56fe</a>'}]},sidebarWidth:{value:100},toolbarHeight:{value:50},viewContent:{value:{rotateTime:300,scaleTime:300,zoomRate:1.5,micrifyRate:.66,overflowSize:100}},elCls:{value:"ui-img-view-wrap"},selectedchange:{value:function(){}}}});return t.mix(a,{ViewContent:i,PreviewList:n}),a}),define("bui/imgview/previewlist",["bui/common","bui/list"],function(e){var t=e("bui/common"),i=e("bui/list"),n=function(e,t){var i=e.width(),n=e.height(),g=new Image,a=jQuery("<img>");return g.onload=function(){var r=g.width,s=g.height;if(r/s>i/n){var h=i/r*s;a.css({width:i,height:h,marginTop:(n-h)/2})}else{var o=n/s*r;a.css({width:o,height:n,marginLeft:(i-o)/2})}a[0].src=t,e.html(a)},g.src=t,g};Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1});var g=t.Component.Controller.extend({initializer:function(){var e=this,t=e.get("children"),n=new i.SimpleList({elCls:e.get("listCls"),itemTpl:e.get("itemTpl")});t.push(n),e.set("list",n)},renderUI:function(){var e=this,t=e.get("list"),i=e.get("alignType"),n=$(t.get("el")).find("ul"),g=e.get("el");e.set("ul",n),g.prepend('<a href="#" class="ui-previewlist-prev J_previewPrev"></a>'),g.append('<a href="#" class="ui-previewlist-next J_previewNext"></a>'),"width"==i&&(n.width(1e4),g.addClass("ui-preview-wrap-width")),n.addClass("clearfix"),e._uiSetHeight()},bindUI:function(){this._bindSelect(),this._bindScroll()},_bindSelect:function(){var e=this,t=e.get("list");t.on("selectedchange",function(t){var i=e.get("items"),n=i.indexOf(t.item),g=e.get("pageSize"),a=e.get("selectedchange");e.set("selected",n),e.setPage(parseInt(n/g)),a&&a(t,n)})},_bindScroll:function(){{var e=this,t=e.get("el");e.get("itemHeight")}t.find(".J_previewNext").on("click",function(t){t.preventDefault(),e.goNext()}),t.find(".J_previewPrev").on("click",function(t){t.preventDefault(),e.goPrev()})},setPage:function(e){var t=this,e="number"==typeof e?e:parseInt(t.get("selected")/t.get("pageSize")),i=t.get("maxPage"),n=!1;return e>=0&&i>e?n=!0:e>=i&&0!=i&&(e=i-1,n=!0),n&&t.set("pageNum",e),n},_uiSetPageNum:function(e){var t=this,i=t.get("ul"),n=t.get("scrollSize"),g=t.get("scrollTime"),a=t.get("alignType");"height"==a?i.clearQueue().animate({marginTop:-e*n},g):"width"==a&&i.clearQueue().animate({marginLeft:-e*n},g)},goPrev:function(){this.setPage(this.get("pageNum")-1)},goNext:function(){this.setPage(this.get("pageNum")+1)},getSelect:function(){return this.get("selected")},getLength:function(){return this.get("items").length||0},_uiSetWidth:function(e){e=e||this.get("width");var t=this,i=t.get("list"),n=t.get("alignType"),g=e-90;"width"==n&&(i.set("width",g),t.set("listWidth",g),t.__initPageInfo())},_uiSetHeight:function(e){e=e||this.get("height");var t=this,i=t.get("list"),n=t.get("alignType"),g=e-90;"height"==n&&(i.set("height",g),t.set("listHeight",g),t.__initPageInfo())},_uiSetSelected:function(e){var t=this,i=t.get("items"),n=t.get("pageSize"),g=t.get("list");0!=i.length&&(g.setSelected(i[e]),t.setPage(parseInt(e/n)))},_uiSetItems:function(e){var t=this,i=t.get("itemWidth"),g=t.get("itemHeight");t.get("list").setItems(e),t.get("el").find(".ui-preview-mini-wrap").each(function(t){$(this).width(i-8).height(g-8),n($(this),e[t].miniSrc)}),t.__initPageInfo(),t.get("_rendered")&&t._uiSetSelected(0),t.set("_rendered",!0)},__initPageInfo:function(){{var e=this,t=e.get("alignType"),i=e.get("itemHeight"),n=e.get("itemWidth"),g=e.get("listHeight"),a=e.get("listWidth");e.get("height")}if("width"==t){var r=parseInt(a/n),s=r*n,h=e.getLength(),o=h%r==0?h/r:parseInt(h/r)+1;e.set("pageSize",r),e.set("scrollSize",s),e.set("maxPage",o)}else if("height"==t){var r=parseInt(g/i),s=r*i,h=e.getLength(),o=h%r==0?h/r:parseInt(h/r)+1;e.set("pageSize",r),e.set("scrollSize",s),e.set("maxPage",o)}},destructor:function(){}},{ATTRS:{elCls:{value:"ui-preview-wrap"},listCls:{value:"ui-preview-simple-list"},itemTpl:{value:'<li class="ui-preview-mini-wrap"></li>'},items:{value:[]},selectedchange:{value:function(){}},selected:{value:0},pageNum:{value:0},itemWidth:{value:100},itemHeight:{value:60},controls:{value:!1},scrollTime:{value:300},alignType:{value:"height"},_rendered:{value:!1}}});return g}),define("bui/imgview/viewcontent",["bui/common","bui/graphic"],function(e){function t(e,t,i,n){var g={};return e/t>i/n?(g.height=i/e*t,g.width=i):(g.width=n/t*e,g.height=n),g.x=(i-g.width)/2,g.y=(n-g.height)/2,g}var i=e("bui/common"),n=e("bui/graphic"),g=i.Component.Controller.extend({initializer:function(){var e=this,n=new Image;e.set("targetImg",n),n.onload=function(){var g=n.width,a=n.height,r=e.get("width"),s=e.get("height"),h=t(g,a,r,s);e.get("imgObj").attr(i.mix(h,{src:n.src,transform:"r0"})),e.set("isPaint",!0),e.set("imgWidth",g),e.set("imgHeight",a),e.set("imgNowWidth",h.width),e.set("imgNowHeight",h.height),e.set("angle",0),e.set("imgSrc",n.src),e.set("isFit",!0)}},renderUI:function(){var e=this,t=(e.get("imgSrc"),e.get("el")),i=new n.Canvas({render:t}),g=i.addShape("image",{});e.set("canvas",i),e.set("imgObj",g)},bindUI:function(){this._bindDrag()},clear:function(){var e=this,t=e.get("canvas");t.destroy(),e.set("isPaint",!1)},reset:function(){this.set("angle",0),this.rotate(0,0),this.scale("fit",0)},leftHand:function(e,t){var i=this,n=i.get("rotateTime"),e=e||"<>";i.rotate(-90,n,e,t)},rightHand:function(e,t){var i=this,n=i.get("rotateTime"),e=e||"<>";i.rotate(90,n,e,t)},rotate:function(e,t,i,n){var g=this,a=g.get("isPaint"),r=g.get("angle"),s=g.get("imgObj"),i=i||"<>";a&&(r+=e,s.attr({x:(g.get("width")-g.get("imgNowWidth"))/2,y:(g.get("height")-g.get("imgNowHeight"))/2}).stopAnimate().animate({transform:"r"+r},t,i,n),g.set("angle",r)),g.set("isFit",!1)},zoom:function(e,t){var i=this,n=i.get("zoomRate"),g=i.get("scaleTime"),e=e||"<>";i.scale(n,g,e,t)},micrify:function(e,t){var i=this,n=i.get("micrifyRate"),g=i.get("scaleTime"),e=e||"<>";i.scale(n,g,e,t)},resume:function(e,t){var i=this,n=i.get("scaleTime"),e=e||"<>";i.scale("resume",n,e,t)},fit:function(e,t){var i=this,n=i.get("scaleTime"),e=e||"<>";i.scale("fit",n,e,t)},fitToggle:function(){var e=this,t=e.get("isFit");t?e.resume():e.fit()},scale:function(e,i,n,g){var a=this,r=a.get("imgObj"),s=a.get("width"),h=a.get("height"),o=a.get("imgWidth"),l=a.get("imgHeight"),c=a.get("imgNowWidth"),u=a.get("imgNowHeight"),m=a.get("isPaint"),v=a.get("angle");if(m){var d=!1;if("resume"==e)c=o,u=l;else if("fit"==e){if(90==Math.abs(v%180)){var f=t(l,o,s,h);c=f.height,u=f.width}else{var f=t(o,l,s,h);c=f.width,u=f.height}d=!0}else c*=e,u*=e;r.stopAnimate().animate({x:(s-c)/2,y:(h-u)/2,width:c,height:u,transform:"r"+v},i,n,g),a.set("imgNowWidth",c),a.set("imgNowHeight",u),a.set("isFit",d)}},getSrc:function(){return this.get("imgSrc")},_getOverflowSize:function(e,t,i,n,g,a,r,s){return e.x+n<s-e.width?n=s-e.width-e.x:e.x+n>a-s&&(n=a-s-e.x),e.y+g<s-e.height?g=s-e.height-e.y:e.y+g>r-s&&(g=r-s-e.y),{x:t+n,y:i+g}},_bindDrag:function(){var e,t,n,g,a,r,s,h,o=this,l=o.get("imgObj");l.drag(function(n,g){if(o.get("drag")){var c=o._getOverflowSize(h,a,r,n,g,e,t,s);l.attr(i.mix(c,{transform:l.attr("transform")}))}},function(){h=l.getBBox(),a=l.attr("x"),r=l.attr("y"),e=o.get("width"),t=o.get("height"),n=o.get("imgNowWidth"),g=o.get("imgNowHeight"),s=Math.min(n,g,o.get("overflowSize"))})},dragToggle:function(){this.get("drag")?this.set("drag",!1):this.set("drag",!0)},_uiSetWidth:function(e){this.get("canvas").setSize(e,this.get("height")||800),this.scale("fit",0)},_uiSetHeight:function(e){this.get("canvas").setSize(this.get("width")||600,e),this.scale("fit",0)},_uiSetImgSrc:function(e){this.get("targetImg").src=e,this.get("afterChanged")(e)},_uiSetDrag:function(e){e?this.get("imgObj").attr("cursor","move"):this.get("imgObj").attr("cursor","default")},destructor:function(){this.clear()}},{ATTRS:{imgSrc:{},isPaint:{value:!1},angle:{value:0},rotateTime:{value:300},scaleTime:{value:300},zoomRate:{value:1.5},micrifyRate:{value:2/3},overflowSize:{value:100},elCls:{value:"ui-view-content"},drag:{value:!0},afterChanged:{value:function(){}}}});return g});